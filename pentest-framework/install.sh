#!/bin/bash

# Script de instalação para Linux
# Framework de Pentest Web

set -e

echo "=========================================="
echo "Framework de Pentest Web - Instalação"
echo "=========================================="
echo ""

# Cores
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Verificar se está rodando como root
if [ "$EUID" -eq 0 ]; then 
    echo -e "${YELLOW}⚠ Aviso: Não execute este script como root${NC}"
    echo "Execute como usuário normal. O script pedirá senha quando necessário."
    exit 1
fi

# Verificar sistema operacional
if [[ "$OSTYPE" != "linux-gnu"* ]]; then
    echo -e "${RED}✗ Este script é apenas para Linux${NC}"
    exit 1
fi

# Função para verificar se comando existe
command_exists() {
    command -v "$1" >/dev/null 2>&1
}

# Atualizar sistema
echo -e "${BLUE}[1/5] Atualizando sistema...${NC}"
sudo apt update

# Instalar Python 3 e pip
echo -e "${BLUE}[2/5] Instalando Python e dependências...${NC}"
sudo apt install -y python3 python3-pip python3-venv

# Criar e ativar ambiente virtual
echo -e "${BLUE}[3/5] Criando ambiente virtual...${NC}"
python3 -m venv venv
source venv/bin/activate

# Instalar dependências Python
echo -e "${BLUE}[4/5] Instalando dependências Python...${NC}"
pip install --upgrade pip
pip install -r requirements.txt

echo ""
echo -e "${BLUE}[5/5] Instalando ferramentas externas...${NC}"
echo "Execute: python3 main.py --install"
echo ""

echo -e "${GREEN}=========================================="
echo "✓ Instalação básica completa!"
echo "==========================================${NC}"
echo ""
echo "Próximos passos:"
echo "1. Ative o ambiente virtual: source venv/bin/activate"
echo "2. Instale as ferramentas: python3 main.py --install"
echo "3. Execute um scan: python3 main.py -u https://target.com --recon"
echo ""

